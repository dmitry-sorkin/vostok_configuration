# Официальная конфигурация 3D принтера VOSTOK

Официальная конфигурация 3D принтера VOSTOK. Использует [экспериментальную версию Klipper'а](https://github.com/dmbutyugin/klipper/tree/generic-cartesian) и, поддерживающую режим прямого управления обеими печатающими головами. Это даёт возможность прочищать неактивную печатающую голову пока активная еще печатает, снижая время смены инструмента до ~0.5-0.7 секунды, а также немного ускоряя парковку и прочие подобные действия.

## Состояние

На данный момент реализовано:

- [x] Парковка всех осей;
- [x] Калибровка Input Shaping'а с учётом особенностей IDEX и автоматическим построение АЧХ;
- [x] Модульное строение конфигурации, позволяющее проще обновлять её, а также использовать чужие модули конфигурации электроники;
- [x] Быстрые макросы парковки осей X, W или XW;
- [x] Макросы переключения режимов IDEX;
- [x] Макросы переключения инструментов, поддерживающие скрипт быстрой смены печатающей головы;
- [x] Стартовые и конечные макросы печати для разных режимов работы IDEX;
- [x] Макросы постановки на паузу, возобновления и отмены печати, учитывающие особенности IDEX принтеров;
- [x] Пример конфигурации для [PrusaSlicer BOSS](https://github.com/mjonuschat/PrusaSlicer).

В планах, но еще не реализовано:

- [ ] Индивидуальная парковка осей;
- [ ] Проверка выхода за границы области печати выбранного режима работы IDEX.

## Как установить

### Переход на ветку Generic-Cartesian

1. Подключитесь к принтеру по SSH;
2. Откройте KIAUH;
3. Перейдите в Settings (`S`);
4. Выберите "Switch Klipper source repository" (`1`);
5. Выберите "Add repository" (`A`);
6. Введите адрес:
```
https://github.com/dmbutyugin/klipper
```
7. Укажите ветку:
```
generic-cartesian
```
8. Сохраните репозиторий (`S`);
9. Переключитесь на добавленный репозиторий, выбрав его из списка.2

### Установка G-Code Shell Command

1. В KIAUH выберите пункт Extensions (`E`);
2. Выберите G-Code Shell Command из списка;
3. Install (`1`);
4. На вопрос "Create an example shell command" ответьте `N`.

### Установка конфигурации

1. Скопируйте файлы `printer_base.cfg`, `printer.cfg` и `electronics_*.cfg` на принтер в папку `~/printer_data/config/` любым способом. Проще всего через веб-интерфейс;
2. Если не было соответствующего вашей электронике `electronics_*.cfg`, то скопируйте любой, переименуйте и внесите в него изменения таким образом, чтобы конфигурация подходила под электронику вашего принтера;
3. Откройте `printer.cfg` и следуйте инструкциям в нём. Именно в этом файле указываются все параметры принтера, которые вам нужно менять, и в нём же можно переопределить значение параметров из `printer_base.cfg`. Ни в коем случае не редактируйте `printer_base.cfg` так как это лишит вас возможности легко обновить конфигурацию;
4. Скачайте [скрипт быстрой смены печатающей головы](https://github.com/dmbutyugin/klipper/blob/generic-cartesian/scripts/gcode/fast_tool_swaps.py) и положите в любую удобную вам папку на компьютере;
5. Импортируйте пример конфигурации (`prusaslicer_vostok_config_example`) в PrusaSlicer или PrusaSlicer (BOSS);
6. В каждом профиле принтера измените размер области печати так, чтобы он соответствовал вашему принтеру. В примере указан размер области печати для размера M с хотэндом Goliath;
7. В профиле печати в разделе `Выходные параметры` укажите правильный путь к python3 и ранее скачанному скрипту;
8. Значения Pressure Advance стоит указывать в профиле филамента, в разделе `Пользовательский G-код` в поле `Пользовательские параметры`.

## Как добавить свою конфигурацию электроники

Надо создать Pull Request с новым файлом конфигурации электроники. При этом к нему есть требования:

- В имени файла должно содержаться название материнской платы и конфигурация драйверов. Если есть еще какие-то специфические элементы электроники, например, коммутационные платы, то надо указать и их название тоже;
- В начале файла должна быть предоставлена схема подключения, для которой составлена эта конфигурация электроники;
- Если конфигурация электроники сложная, то лучше написать комментарии, которые позволят другим пользователям разобраться в ней;
- Если вы хотите обновить свою конфигурацию, то в комментарии в начале файла стоит указать список изменений.

## ЧАВО

Вопрос: Можно ли использовать не PrusaSlicer, а OrcaSlicer?

Ответ: Да, но в OrcaSlicer нет пользовательских параметров, которые используются для хранения информации о Pressure Advance. Данныые Pressure Advance для стартовых макросов придётся указывать по-другому.

---

Вопрос: Стоит ли обновляться на эту конфигурацию?

Ответ: Если принтер работает на какой-либо старой конфигурации, и вас всё устраивает, то не трогайте ничего. Обновляться стоит только в том случае, если вам нужна функция быстрой смены печатающей головы.

---

Вопрос: Насколько стабильна эта конфигурация?

Ответ: Сама по себе конфигурация достаточно хорошо протестирована, и проблем в работе любых режимов IDEX не замечено. Но надо понимать, что конфигурация составлена под экспериментиальную ветку Klipper'а. И нет 100% гарантий, что в этой ветке не будет каких-то значимых изменений, которые, в свою очередь, могут потребовать изменений в конфигурации.

---

Вопрос: Как сообщить об ошибке или проблеме?
Ответ: Добавить issue, в котором подробно описать проблему.
