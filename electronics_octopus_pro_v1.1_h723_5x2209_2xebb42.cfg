# Базовая конфигурация VOSTOK v9.0
# ------------------------
# Файл распространяется под лицензией CC-BY 4.0
# ------------------------
#
# Плата: BigTreeTech Octopus Pro v1.1 H723
# Плата головы: BigTreeTech EBB42 CAN V1.2.1
# Драйверы: 5x tmc2209
# Датчик автоуровня: BTT Microprobe
# Доп.оборудование: подсветка отсека печати
#
#
# Платы MCU и головы подключаються по CAN-Bus. Секция [mcu] в printer.cfg выглядит следующим образом:
#[mcu]
#canbus_uuid: 2596c52b488f #bash: python3 ~/katapult/scripts/flashtool.py -i can0 -q
#
#[mcu T0_EBB]
#canbus_uuid: 6d5ad4c961d9 #bash: python3 ~/katapult/scripts/flashtool.py -i can0 -q
#
#[mcu T1_EBB]
#canbus_uuid: 2c744beb9452 #bash: python3 ~/katapult/scripts/flashtool.py -i can0 -q
#
#Лучший гайд по CAN-bus на просторах интернета: https://canbus.esoterical.online/
#
#
#--------------------------------------------------------
#          Оборудование             |      Разъём       |
#-----------------------------------|-------------------|
# Мотор оси X                       | MOTOR0            |
# Мотор оси W                       | MOTOR1            |
# Левый мотор оси Y                 | MOTOR2            |
# Правый мотор оси Y                | MOTOR3            |
# Мотор оси Z                       | MOTOR4            |
# Мотор фидера левой головы         | T0_EBB E-MOT      |
# Мотор фидера правой головы        | T1_EBB E-MOT      |
# Нагреватель левой головы          | T0_EBB Hotend     |
# Нагреватель правой головы         | T1_EBB Hotend     |
# Нагреватель стола                 | HE0               |
# Термистор левой головы            | T0_EBB TH0        |
# Термистор правой головы           | T1_EBB TH0        |
# Термистор стола                   | TB                |
# Охлаждение хотэнда левой головы   | T0_EBB FAN 0      |
# Охлаждение хотэнда правой головы  | T1_EBB FAN 0      |
# Охлаждение платы левой головы     | T0_EBB FAN 1      |
# Охлаждение платы правой головы    | T1_EBB FAN 1      |
# Охлаждение модели                 | FAN0              | (Питание драйвера ws7040 подключается к БП 24 В. На пин подключается только пин ШИМ драйвера. Подробнее: https://www.bondtech.se/downloads/SetupGuides/bondtech_EXT-KIT-97-03_EXT-KIT-97-04_15173_CPAP-supplementary-wiring-guide.pdf?srsltid=AfmBOoqhJIR2pmFrltkhaex3I70HB_p1164zM7Zs-7mOxGRSqt0oVGx8)
# Охлаждение отсека электроники     | FAN1              |
# Концевик оси X                    | T0_EBB STOP0      |
# Концевик оси W                    | T1_EBB STOP0      |
# Концевик оси Y левый              | STOP2             |
# Концевик оси Y правый             | STOP3             |
# Датчик автоуровня                 | T0_EBB BLtouch    |
# Подсветка отсека печати           | HE3               |
#--------------------------------------------------------

#########################################################
# Двигатели
#########################################################

[stepper motor_x]
step_pin: PF13
dir_pin: !PF12
enable_pin: !PF14
full_steps_per_rotation: 200

[stepper motor_w]
step_pin: PG0
dir_pin: !PG1
enable_pin: !PF15
full_steps_per_rotation: 200

[stepper motor_yl]
step_pin: PF11
dir_pin: !PG3
enable_pin: !PG5
full_steps_per_rotation: 200

[stepper motor_yr]
step_pin: PG4
dir_pin: PC1
enable_pin: !PA2
full_steps_per_rotation: 200

[stepper motor_z]
step_pin: PF9
dir_pin: !PF10
enable_pin: !PG2
full_steps_per_rotation: 200

[extruder]
step_pin: T0_EBB: PD0
dir_pin: !T0_EBB: PD1
enable_pin: !T0_EBB: PD2
full_steps_per_rotation: 200

[extruder1]
step_pin: T1_EBB: PD0
dir_pin: T1_EBB: PD1
enable_pin: !T1_EBB: PD2
full_steps_per_rotation: 200

#########################################################
# Драйверы
#########################################################

[tmc2209 stepper motor_x]
uart_pin: PC4
run_current: 1.1
stealthchop_threshold: 0
interpolate: False

[tmc2209 stepper motor_w]
uart_pin: PD11
run_current: 1.1
stealthchop_threshold: 0
interpolate: False

[tmc2209 stepper motor_yl]
uart_pin: PC6
run_current: 1.1
stealthchop_threshold: 0
interpolate: False

[tmc2209 stepper motor_yr]
uart_pin: PC7
run_current: 1.1
stealthchop_threshold: 0
interpolate: False

[tmc2209 stepper motor_z]
uart_pin: PF2
run_current: 1.2
stealthchop_threshold: 0

[tmc2209 extruder]
uart_pin: T0_EBB: PA15
run_current: 0.8
stealthchop_threshold: 0

[tmc2209 extruder1]
uart_pin: T1_EBB: PA15
run_current: 0.8
stealthchop_threshold: 0

#########################################################
# Концевики и датчик автоуровня
#########################################################

[carriage xc]
endstop_pin: ^T0_EBB: PB6

[dual_carriage wc]
endstop_pin: ^T1_EBB: PB6

[carriage ylc]
endstop_pin: ^PG10

[extra_carriage yrc]
endstop_pin: ^PG11

[probe]
pin: ^!T0_EBB: PB8

[output_pin probe_enable]
pin: T0_EBB: PB9
value: 0

[gcode_macro PROBE_DEPLOY]
gcode:
    SET_PIN PIN=probe_enable VALUE=1

[gcode_macro PROBE_STOW]
gcode:
    SET_PIN PIN=probe_enable VALUE=0

#########################################################
# Нагреватели и термисторы
#########################################################

[extruder]
heater_pin: T0_EBB: PB13
sensor_pin: T0_EBB: PA3

[extruder1]
heater_pin: T1_EBB: PB13
sensor_pin: T1_EBB: PA3

[heater_bed]
heater_pin: PA0
sensor_pin: PF3

#########################################################
# Вентиляторы
#########################################################

[fan]
pin: PG12

[heater_fan e0_fan]
pin: T0_EBB: PA0

[heater_fan e1_fan]
pin: T1_EBB: PA0

[controller_fan electronics_fan]
pin: PE5

[controller_fan T0_EBB_fan]
pin: T0_EBB: PA1

[controller_fan T1_EBB_fan]
pin: T1_EBB: PA1

#########################################################
# Подсветка
#########################################################

[led print_chamber_led]
white_pin: PB11
initial_WHITE: 1.0

#########################################################
# Температуры плат
#########################################################

[temperature_sensor host]
sensor_type: temperature_host

[temperature_sensor Octopus_Pro]
sensor_type: temperature_mcu

[temperature_sensor T0_EBB]
sensor_type: temperature_mcu
sensor_mcu: T0_EBB

[temperature_sensor T1_EBB]
sensor_type: temperature_mcu
sensor_mcu: T1_EBB